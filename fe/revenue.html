<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monthly Sales Report</title>
    <style>
      :root {
        --background-color: #ffd1dc;
        --header-background: rgb(3, 7, 7);
        --primary-color: #ff6347;
        --secondary-color: #000103;
        --white: #ffffff;
      }

      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: var(--background-color);
        box-sizing: border-box;
      }

      .header {
        background: rgb(179, 231, 235);
        color: white;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        padding: 15px 30px;
        z-index: 1000;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .header .logo {
        width: 100px;
        height: 50px;
        background: rgb(179, 231, 235);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #000103;
        margin-right: 20px;
      }

      .header h1 {
        font-size: 45px;
        color: #000103;
        margin: 0;
        margin-right: 20px;
        font-family: "Dancing Script", cursive;
        font-weight: 700;
      }

      .header .buttons {
        display: flex;
        gap: 15px;
        justify-content: flex-end; /* Align buttons to the right */
        margin-right: 70px; /* Adds space from the right edge */
      }

      .header .buttons button {
        background: white;
        color: #000103;
        border: none;
        border-radius: 4px;
        padding: 10px 15px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.2s;
      }

      .header .buttons button:hover {
        background: #ff6347;
        color: white;
      }

      .ParameterSelect {
        max-width: 1200px;
        margin: 120px auto 0;
        padding: 20px;
      }

      .filters {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        justify-content: center;
        align-items: center;
      }

      .filters select,.filters input, .filters button {
        padding: 10px;
        font-size: 16px;
        border-radius: 4px;
        border: 1px solid #ddd;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      th,
      td {
        padding: 10px;
        text-align: center;
        border: 1px solid #ddd;
      }

      th {
        background-color: var(--primary-color);
        color: var(--white);
      }

      td {
        background-color: #f9f9f9;
      }

      @media (max-width: 768px) {
        .ParameterSelect {
          margin-top: 80px;
        }

        table {
          font-size: 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="logo">
        <img src="images/hcmut.png" alt="Logo" />
      </div>
      <h1>HCMUT Fashion Shop</h1>
      <div class="buttons">
        <button onclick="location.href='products.html'">Products</button>
        <button onclick="location.href='discount.html'">Discount</button>
        <button onclick="location.href='revenue.html'">Revenue</button>
      </div>
    </div>

    <div class="ParameterSelect">
        <h2>Select Report Parameters</h2>
        <div class="filters">
            <label for="storeSelector">Store:</label>
            <select id="storeSelector">
                <option value="storeAll">All</option>
                <option value="store1">Store 1</option>
                <option value="store2">Store 2</option>
                <option value="store3">Store 3</option>
            </select>
    
            <label for="monthSelector">Month:</label>
            <select id="monthSelector">
                <option value="monthAll">All</option>
                <option value="01">January</option>
                <option value="02">February</option>
                <option value="03">March</option>
                <option value="04">April</option>
                <option value="05">May</option>
                <option value="06">June</option>
                <option value="07">July</option>
                <option value="08">August</option>
                <option value="09">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>
    
            <label for="yearSelector">Year:</label>
            <input type="text" id="yearSelector" placeholder="Enter Year" />
        <button id="submitBtn">Submit</button> 
        </div>
        
    </div>

      <div id="reportContainer">
        <h2 style="text-align: center;">
            Sales Report
            <br>
            <span id="reportPeriod"> Store: All Stores - Month: All Months - Year: All Years </span>
          </h2>
        <table
          border="1"
          style="border-collapse: collapse; text-align: center"
          id="reportTable"
          class="report-table"
        >
          <colgroup>
            <col style="width: 20vw" />
            <col style="width: 15vw" />
            <col style="width: 7.5vw" />
            <col style="width: 7.5vw" />
            <col style="width: 7.5vw" />
            <col style="width: 7.5vw" />
            <col style="width: 17.5vw" />
            <col style="width: 17.5vw" />
          </colgroup>
          <thead>
            <tr>
              <th rowspan="2">Product Name</th>
              <th rowspan="2">Color</th>
              <th colspan="4">Size</th>
              <th rowspan="2">Quantity Sold</th>
              <th rowspan="2">Total Revenue</th>
            </tr>
            <tr>
              <th>S</th>
              <th>M</th>
              <th>L</th>
              <th>D</th>
            </tr>
          </thead>

          <tbody>
          </tbody>
        </table>

        <h3 id="totalRevenue">Total Revenue: $0</h3>
        <h3 id="totalOrders">Total Orders: 0</h3>
      </div>
    </div>

    <script>
    //   function updateReport() {
    //     const store = document.getElementById("storeSelector").value;
    //     const month = document.getElementById("monthSelector").value;
    //     const year = document.getElementById("yearSelector").value;

    //     const reportTableBody = document.getElementById("reportTableBody");
    //     const totalRevenueElem = document.getElementById("totalRevenue");
    //     const totalOrdersElem = document.getElementById("totalOrders");
    //     const reportPeriodElem = document.getElementById("reportPeriod");

    //     const data = reports[store]?.[year]?.[month] || [];

    //     reportTableBody.innerHTML = "";
    //     let totalRevenue = 0;
    //     let totalOrders = 0;

    //     data.forEach(({ product, color, size, quantity, revenue }) => {
    //       const row = document.createElement("tr");
    //       row.innerHTML = `
    //                 <td>${product}</td>
    //                 <td>${color}</td>
    //                 <td>${size}</td>
    //                 <td>${quantity}</td>
    //                 <td>$${revenue}</td>
    //             `;
    //       reportTableBody.appendChild(row);
    //       totalRevenue += revenue;
    //       totalOrders += quantity;
    //     });

    //     reportPeriodElem.textContent = `${getMonthName(month)} ${year}`;
    //     totalRevenueElem.textContent = `Total Revenue: $${totalRevenue}`;
    //     totalOrdersElem.textContent = `Total Orders: ${totalOrders}`;
    //   }

    document.addEventListener("DOMContentLoaded", function() {
    const storeSelector = document.getElementById("storeSelector");
    const monthSelector = document.getElementById("monthSelector");
    const yearSelector = document.getElementById("yearSelector");
    const submitBtn = document.getElementById("submitBtn"); // Nút submit mới
    const reportTable = document.getElementById("reportTable");
    const reportPeriod = document.getElementById("reportPeriod");
    const totalRevenue = document.getElementById("totalRevenue");
    const totalOrders = document.getElementById("totalOrders");

    // Lắng nghe sự kiện bấm nút submit
    submitBtn.addEventListener("click", async () => {
        // const storeID = storeSelector.value;
        let storeID="storeAll";
        const month = monthSelector.value;
        const year = yearSelector.value;

        // Kiểm tra xem có đủ thông tin để gọi API không
        const parameter="";
        console.log("storeID:",storeID);
        console.log("month:",month);
        console.log("year:",year);
        if(storeID!="storeAll") parameter+=`storeID=${storeID}&`;
        if(month!="monthAll") parameter+=`month=${getMonthName(month)}&`;
        if(year!="") parameter+=`year=${year}`;
        if(parameter!="") parameter='?'+parameter;
        console.log("parameter:",parameter);
        // URL API
        const api_url = "http://localhost:3000/api"; // Thay thế với URL của API
        const url = `${api_url}/revenue/get${parameter}`;

        try {
        // Gọi API
        const response = await fetch(url);
        const data = await response.json();
        console.log("data:",data);

        // Cập nhật tiêu đề báo cáo
        textContent = "";
        if (storeID === "storeAll") {
            textContent += "Store: All Stores - ";
        } else {
            textContent += `Store: ${storeID} - `;
        }
        if(month === "monthAll") {
            textContent += "Month: All Months - ";
        } else {
            textContent += `Month: ${getMonthName(month)} - `;
        }
        if (year === "") {
            textContent += "Year: All Years";
        } else {
            textContent += `Year: ${year}`;
        }
        reportPeriod.textContent = textContent;

        // Xóa dữ liệu cũ trong bảng
        reportTable.querySelector("tbody").innerHTML = "";

        let totalRevenueAmount = 0;
        let totalOrdersCount = 0;

        // Lặp qua dữ liệu trả về và hiển thị trong bảng
        data.forEach(product => {
            const row = document.createElement("tr");

            // Tạo các ô cho từng row: Product, Size, Color, Quantity, Total Revenue
            row.innerHTML = `
            <td>${product.productName}</td>
            <td>${product.color}</td>
            <td>${product.sizeS}</td>
            <td>${product.sizeM}</td>
            <td>${product.sizeL}</td>
            <td>${product.sizeD}</td>
            <td>${product.quantitySold}</td>
            <td>${product.totalRevenue}</td>
            `;

            // Thêm row vào bảng
            reportTable.querySelector("tbody").appendChild(row);

            // Cộng dồn doanh thu và đơn hàng
            totalRevenueAmount += parseFloat(product.totalRevenue);
            totalOrdersCount += product.quantitySold;
        });

        // Cập nhật tổng doanh thu và tổng số đơn hàng
        totalRevenue.textContent = `Total Revenue: $${totalRevenueAmount.toFixed(2)}`;
        totalOrders.textContent = `Total Orders: ${totalOrdersCount}`;
        } catch (error) {
        console.error("Error fetching data:", error);
        }
    });
    });


      function getMonthName(month) {
        const months = {
          "01": "January",
          "02": "February",
          "03": "March",
          "04": "April",
          "05": "May",
          "06": "June",
          "07": "July",
          "08": "August",
          "09": "September",
          "10": "October",
          "11": "November",
          "12": "December",
        };
        return months[month];
      }
      
    </script>
  </body>
</html>
